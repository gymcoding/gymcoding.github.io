(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{475:function(t,s,a){"use strict";a.r(s);var e=a(7),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"들어가며"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#들어가며"}},[t._v("#")]),t._v(" 들어가며")]),t._v(" "),a("p",[t._v("최근 진행하는 IoT Platform에서 MQTT 기반 데이터 수집이라는 미션을 받게되었다. 수집 모듈은 MQTT Broker의 Topic을 구독하는 모듈이다. 이 모듈의 테스트를 위해 MQTT Broker를 Docker로 간단히 구성해보자.")]),t._v(" "),a("h2",{attrs:{id:"mqtt란"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mqtt란"}},[t._v("#")]),t._v(" MQTT란?")]),t._v(" "),a("p",[t._v("MQTT(메시지 큐잉 텔레메트리 트랜스포트, Message Queuing Telemetry Transport)는 ISO 표준 발행-구독(Pub-Sub) 기반의 메시징 프로토콜이다."),a("br"),t._v("\nTCP/IP 프로토콜 위에서 동작하며, 사물인터넷(임베디드)을 사용하기 위해 개발된 프로토콜 이다. TCP 기반의 프로토콜로서 낮은 전력 낮은 대역폭 낮은 성능의 환경에서도 사용이 가능하다.")]),t._v(" "),a("h3",{attrs:{id:"mqtt-구성요소"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mqtt-구성요소"}},[t._v("#")]),t._v(" MQTT 구성요소")]),t._v(" "),a("p",[t._v("MQTT는 메시지를 발행하는 발행자(Publisher)와 메시지를 구독하는 구독자(Subscriber) 그리고 이 둘을 중계하는 브로커(Broker)로 구성되며, 메시지는 Topic으로 분류 된다.")]),t._v(" "),a("ul",[a("li",[t._v("Publisher (발행자)")]),t._v(" "),a("li",[t._v("Topic (메시지 분류 그룹)")]),t._v(" "),a("li",[t._v("Broker (중계자)")]),t._v(" "),a("li",[t._v("Subscriber (구독자)")])]),t._v(" "),a("h2",{attrs:{id:"eclipse-mosquitto란"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eclipse-mosquitto란"}},[t._v("#")]),t._v(" eclipse-mosquitto란?")]),t._v(" "),a("p",[t._v("Eclipse Mosquitto는 MQTT 버전 5, 3.1.1 및 3.1을 구현하는 "),a("strong",[t._v("오픈 소스 메시지 브로커")]),t._v("입니다.")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://mosquitto.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("공식 사이트"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/eclipse/mosquitto",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://hub.docker.com/_/eclipse-mosquitto",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker hub"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"eclipse-mosquitto-설치하기"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eclipse-mosquitto-설치하기"}},[t._v("#")]),t._v(" eclipse-mosquitto 설치하기")]),t._v(" "),a("ol",[a("li",[t._v("Docker Image 환경설정 폴더 생성")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" eclipse-mosquitto\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" eclipse-mosquitto\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Compose"),a("OutboundLink")],1),t._v(" 환경설정 파일 생성")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" docker-compose.yml\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Docker Compose 환경구성")])]),t._v(" "),a("ul",[a("li",[t._v("docker-compose.yml 파일생성")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" docker-compose.yml\n")])])]),a("ul",[a("li",[t._v("docker-compose.yml 파일에 서비스 환경구성")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.2'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mosquitto")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"eclipse-mosquitto"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1883:1883"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"9001:9001"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("USER_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOSQUITTO_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/config/mosquitto.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/mosquitto/config/mosquitto.conf\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("USER_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOSQUITTO_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/mosquitto/data\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("USER_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("MOSQUITTO_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/mosquitto/log\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("환경설정 파일 및 로그, 데이터 디렉토리 생성")])]),t._v(" "),a("ul",[a("li",[t._v("환경구성, 저장소 및 로그에 사용할 이미지에 세 개의 디렉터리 생성")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 테스트를 위해 eclipse-mosquitto 폴더 하위에 생성하였습니다.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" log\n")])])]),a("ul",[a("li",[t._v("./config/mosquitto.conf 파일 생성")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" ./config/mosquitto.conf\n")])])]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[t._v("서비스를 위하여 컨테이너를 빌드-생성-시작 합니다.")])]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker-compose up\n")])])]),t._v(" "),a("h2",{attrs:{id:"테스트-진행"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#테스트-진행"}},[t._v("#")]),t._v(" 테스트 진행")]),t._v(" "),a("p",[t._v("MQTT Pub-Sub을 테스트 하기 위해서는 mosquitto-clients 모듈을 설치해야 한다.")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" mosquitto-clients\n")])])]),a("h3",{attrs:{id:"publish-테스트"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#publish-테스트"}},[t._v("#")]),t._v(" Publish 테스트")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mosquitto_pub -h localhost -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1883")]),t._v(" -t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" -m "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message2'")]),t._v("\n")])])]),a("h3",{attrs:{id:"subscribe-테스트"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#subscribe-테스트"}},[t._v("#")]),t._v(" Subscribe 테스트")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("mosquitto_sub -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1883")]),t._v(" -t "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v("\n")])])]),a("h3",{attrs:{id:"broker-container-로그-확인"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#broker-container-로그-확인"}},[t._v("#")]),t._v(" Broker(Container) 로그 확인")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 컨테이너 ID 확인")]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Container 로그 출력")]),t._v("\ndocker logs -t -f "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${컨테이너 ID}")]),t._v("\n")])])]),a("p",[t._v("지금까지 Docker로 MQTT 브로커를 설치한 후 mosquitto-clients를 설치하여 Publish(발행)와 Subscribe(구독)을 간단히 테스트 해보았다.")])])}),[],!1,null,null,null);s.default=r.exports}}]);